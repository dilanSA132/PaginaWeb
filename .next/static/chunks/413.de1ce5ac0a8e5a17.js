"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[413],{98413:function(e,r,t){t.r(r),t.d(r,{default:function(){return p}});var a=t(85893),s=t(67294),o=t(55678);t(79422),t(16141);var n=t(71167),i=t.n(n),l=t(8089),c=t(30989);let d="http://localhost:3000/api/v1";async function m(){let e=await fetch("".concat(d,"/email"));if(!e.ok)throw Error("Error al obtener los correos");return await e.json()}async function u(e){let r=await fetch("".concat(d,"/email"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)throw Error("Error al crear el correo");return await r.json()}async function h(e){let r=await fetch("".concat(d,"/email/").concat(e),{method:"DELETE"});if(!r.ok)throw Error("Error al eliminar el correo");return await r.json()}var p=e=>{let{onSendSuccess:r}=e,[t,n]=(0,s.useState)(""),[d,p]=(0,s.useState)(""),[x,f]=(0,s.useState)([]),[g,b]=(0,s.useState)(!1),[j,w]=(0,s.useState)(null),[y,N]=(0,s.useState)("marketing"),[v,E]=(0,s.useState)(""),[S,k]=(0,s.useState)([]),[C,A]=(0,s.useState)(""),[T,D]=(0,s.useState)(!1),[O,P]=(0,s.useState)([]),I={marketing:"\n      <p>\xa1Hola, {{name}}!</p>\n      <p>Queremos informarte sobre nuestras ofertas exclusivas para ti.</p>\n      <p>No te pierdas nuestras promociones especiales. Vis\xedtanos hoy mismo.</p>\n      <p>\xa1Gracias por ser parte de nuestra comunidad!</p>\n    ",payment:"\n      <p>Estimado {{name}},</p>\n      <p>Este es un recordatorio de que tu pago est\xe1 pendiente. Por favor, realiza el pago lo antes posible.</p>\n      <p>Detalles del pago:</p>\n      <p>Asunto: Pago pendiente</p>\n      <p>Gracias por tu atenci\xf3n.</p>\n    ",info:"\n      <p>Hola {{name}},</p>\n      <p>Te estamos enviando este correo para mantenerte informado sobre las \xfaltimas actualizaciones.</p>\n      <p>Visita nuestro sitio web para m\xe1s detalles.</p>\n      <p>\xa1Gracias por seguir con nosotros!</p>\n    "};(0,s.useEffect)(()=>{(async()=>{try{let e=await (0,c.Rf)();k(e)}catch(e){console.error("Error obteniendo usuarios:",e),w("No se pudieron cargar los usuarios.")}})()},[]),(0,s.useEffect)(()=>{E(I[y])},[y]),(0,s.useEffect)(()=>{(async()=>{try{let e=await m();P(e)}catch(e){console.error("Error obteniendo correos:",e),w("No se pudieron cargar los correos.")}})()},[]);let L=(e,r)=>{r?f(r=>[...r,e]):f(r=>r.filter(r=>r.id!==e.id))},F=e=>{D(e),e?f(S):f([])},_=async e=>{let r=O[e];console.log("Este es el emailToDelete ",r);try{await h(r.id),P(r=>r.filter((r,t)=>t!==e)),o.Am.success("Correo eliminado exitosamente")}catch(e){console.error("Error al eliminar el correo:",e),o.Am.error("Ocurri\xf3 un error al eliminar el correo")}},G=async e=>{if(e.preventDefault(),0===x.length){o.Am.error("Por favor, selecciona al menos un usuario.");return}b(!0),w(null);try{await Promise.all(x.map(async e=>{let r=v.replace("{{name}}",e.name),a={userName:e.name,email:e.email,subject:t,type:y,content:r,createdAt:d?new Date(d).toISOString():new Date().toISOString()},s=new Date().toISOString().split("T")[0],n=new Date(a.createdAt).toISOString().split("T")[0];console.log("comparaciom ",n,s),n===s?(await (0,l.C)(t,r,e.email),await u(a),P(e=>[...e,a]),o.Am.success("Correos enviados exitosamente")):(await u(a),P(e=>[...e,a]),o.Am.info("Se creo correctamente, se enviar\xe1 la fecha correspondiente."))})),r()}catch(e){e instanceof Error?(w(e.message),o.Am.error(e.message)):(o.Am.error("Ocurri\xf3 un error desconocido"),w("Ocurri\xf3 un error desconocido"))}finally{b(!1)}},J=S.filter(e=>e.name.toLowerCase().includes(C.toLowerCase())||e.email.toLowerCase().includes(C.toLowerCase()));return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto p-10 bg-white shadow-lg rounded-lg",children:[(0,a.jsx)("h1",{className:"text-4xl font-semibold text-center text-gray-800 mb-8",children:"Enviar Correos Personalizados"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-12",children:[(0,a.jsxs)("div",{className:"p-8 bg-gray-100 rounded-lg shadow-md",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Vista Previa y Edici\xf3n"}),(0,a.jsx)(i(),{theme:"snow",value:v,onChange:E,className:"h-96 border rounded-md overflow-y-auto"})]}),(0,a.jsx)("div",{className:"space-y-8",children:(0,a.jsxs)("form",{onSubmit:G,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"subject",className:"block text-sm font-medium text-gray-700",children:"Asunto:"}),(0,a.jsx)("input",{type:"text",id:"subject",className:"mt-1 p-3 w-full text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:t,onChange:e=>n(e.target.value),required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"scheduleDate",className:"block text-sm font-medium text-gray-700",children:"Enviar Programado:"}),(0,a.jsx)("input",{type:"datetime-local",id:"scheduleDate",className:"mt-1 p-3 w-full text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:d,onChange:e=>p(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"currentDate",className:"block text-sm font-medium text-gray-700",children:"Fecha Actual:"}),(0,a.jsx)("button",{type:"button",id:"currentDate",className:"mt-1 p-2 bg-gray-300 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:()=>p(new Date().toISOString().slice(0,16)),children:"Actual"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"template",className:"block text-sm font-medium text-gray-700",children:"Seleccionar Plantilla:"}),(0,a.jsxs)("select",{id:"template",className:"mt-1 p-3 w-full text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:y,onChange:e=>N(e.target.value),children:[(0,a.jsx)("option",{value:"marketing",children:"Marketing"}),(0,a.jsx)("option",{value:"payment",children:"Aviso de Pago"}),(0,a.jsx)("option",{value:"info",children:"Informaci\xf3n"})]})]}),(0,a.jsx)("div",{children:(0,a.jsx)("input",{type:"text",placeholder:"Filtrar usuarios por nombre o correo",className:"mt-1 p-3 w-full text-sm border border-gray-300 rounded-md shadow-sm",value:C,onChange:e=>A(e.target.value)})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Selecciona Usuarios:"}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-80",children:(0,a.jsxs)("table",{className:"w-full mt-2 border text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-3 border",children:(0,a.jsx)("input",{type:"checkbox",checked:T,onChange:e=>F(e.target.checked)})}),(0,a.jsx)("th",{className:"p-3 border",children:"Nombre"}),(0,a.jsx)("th",{className:"p-3 border",children:"Email"})]})}),(0,a.jsx)("tbody",{children:J.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"p-3 border text-center",children:(0,a.jsx)("input",{type:"checkbox",checked:x.some(r=>r.id===e.id),onChange:r=>L(e,r.target.checked)})}),(0,a.jsx)("td",{className:"p-3 border",children:e.name}),(0,a.jsx)("td",{className:"p-3 border",children:e.email})]},e.id))})]})})]}),j&&(0,a.jsx)("p",{className:"text-red-500 text-xs",children:j}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-6 py-3 rounded-lg text-sm font-semibold hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-500 disabled:bg-gray-300",disabled:g,children:g?"Enviando...":"Enviar Correos"})})]})}),(0,a.jsxs)("div",{className:"col-span-1 lg:col-span-1 mt-8 lg:mt-0 max-h-96 overflow-y-auto",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Correos Enviados:"}),(0,a.jsxs)("table",{className:"w-full mt-2 border text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-3 border",children:"Asunto"}),(0,a.jsx)("th",{className:"p-3 border",children:"Destinatario"}),(0,a.jsx)("th",{className:"p-3 border",children:"Fecha de Env\xedo"}),(0,a.jsx)("th",{className:"p-3 border",children:"Tipo"}),(0,a.jsx)("th",{className:"p-3 border",children:"Acciones"})]})}),(0,a.jsx)("tbody",{children:O.map((e,r)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"p-3 border",children:e.subject}),(0,a.jsx)("td",{className:"p-3 border",children:e.email}),(0,a.jsx)("td",{className:"p-3 border",children:new Date(e.createdAt).toLocaleString()}),(0,a.jsx)("td",{className:"p-3 border",children:e.type}),(0,a.jsx)("td",{className:"p-3 border text-center",children:(0,a.jsx)("button",{className:"bg-red-500 text-white px-3 py-2 rounded hover:bg-red-600",onClick:()=>_(r),children:"Eliminar"})})]},r))})]})]})]}),(0,a.jsx)(o.Ix,{})]})})}},8089:function(e,r,t){t.d(r,{C:function(){return a}});let a=async(e,r,t)=>{let a=await fetch("".concat("http://localhost:3000/api/v1","/emails"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subject:e,html:r,recipientEmail:t})});if(!a.ok)throw Error((await a.json()).message||"Error enviando correo");return a.json()}},30989:function(e,r,t){t.d(r,{Nq:function(){return i},Rf:function(){return s},h8:function(){return n},r4:function(){return o}});let a=t(83454).env.NEXT_PUBLIC_API_URL||"http://localhost:3000/api/v1/users",s=async()=>{try{let e=await fetch(a,{method:"GET"});if(!e.ok){let r=await e.json();throw Error(r.message||"Error fetching users")}return await e.json()}catch(e){throw console.error("Error fetching users:",e),e}},o=async e=>{try{console.log("Este es el usuario ",e);let r=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok){let e=await r.json();throw Error(e.message||"Error creating user")}return await r.json()}catch(e){throw console.error("Error creating user:",e),e}},n=async e=>{try{let r=await fetch("".concat(a,"/").concat(e),{method:"DELETE"});if(!r.ok){let e=await r.json();throw Error(e.message||"Error deleting user")}return await r.json()}catch(e){throw console.error("Error deleting user:",e),e}},i=async(e,r)=>{try{let t=await fetch("".concat(a,"/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!t.ok){let e=await t.json();throw Error(e.message||"Error updating user")}return await t.json()}catch(e){throw console.error("Error updating user:",e),e}}}}]);