(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[763],{25484:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/saleMaintenance",function(){return a(470)}])},74:function(e,t,a){"use strict";var r=a(85893),n=a(67294),o=a(70739);t.Z=e=>{let{columns:t,data:a=[],onEdit:s,onDelete:l}=e,[i,d]=(0,n.useState)(1),[c,m]=(0,n.useState)(""),u=Array.isArray(a)?a.filter(e=>t.some(t=>(t.accessor?e[t.accessor]:"").toString().toLowerCase().includes(c.toLowerCase()))):[],h=(i-1)*15,x=u.slice(h,h+15),p=Math.ceil(u.length/15);return(0,r.jsxs)("div",{className:"w-full",children:[(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsx)("input",{type:"text",placeholder:"Buscar...",value:c,onChange:e=>{m(e.target.value),d(1)},className:"px-4 py-2 border border-gray-300 rounded-md w-full text-black"})}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsx)("div",{className:"shadow-lg rounded-lg",children:(0,r.jsxs)("table",{className:"min-w-full bg-white",children:[(0,r.jsx)("thead",{className:"bg-gradient-to-r from-teal-500 to-green-500 text-white",children:(0,r.jsxs)("tr",{children:[t.map((e,t)=>(0,r.jsx)("th",{className:"py-3 px-6 text-left text-xs font-bold uppercase tracking-wider",children:e.label},t)),(s||l)&&(0,r.jsx)("th",{className:"py-3 px-6 text-left text-xs font-bold uppercase tracking-wider",children:"Acciones"})]})}),(0,r.jsx)("tbody",{className:"bg-white",children:x.length>0?x.map((e,a)=>(0,r.jsxs)("tr",{className:"border-b transition duration-300 ease-in-out hover:bg-gray-100",children:[t.map((t,a)=>(0,r.jsx)("td",{className:"py-3 px-6 text-gray-700 whitespace-nowrap",children:t.render?t.render(e):e[t.accessor]},a)),(s||l)&&(0,r.jsxs)("td",{className:"py-3 px-6 text-gray-700 flex items-center space-x-2 text-black",children:[s&&(0,r.jsx)("button",{onClick:()=>s(e),className:"text-blue-500 hover:text-blue-700",children:(0,r.jsx)(o.fmQ,{})}),l&&(0,r.jsx)("button",{onClick:()=>l(e),className:"text-red-500 hover:text-red-700",children:(0,r.jsx)(o.AMf,{})})]})]},a)):(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:t.length+1,className:"text-center py-4 text-gray-700",children:"No se encontraron resultados"})})})]})})}),(0,r.jsxs)("div",{className:"flex justify-between items-center p-4 bg-gray-100 mt-4",children:[(0,r.jsx)("button",{onClick:()=>{i>1&&d(e=>e-1)},disabled:1===i,className:"bg-teal-500 text-white py-2 px-4 rounded-full flex items-center justify-center ".concat(1===i?"opacity-50 cursor-not-allowed":"hover:bg-teal-600"),children:(0,r.jsx)(o.bUI,{})}),(0,r.jsxs)("span",{className:"text-gray-700",children:["P\xe1gina ",i," de ",p]}),(0,r.jsx)("button",{onClick:()=>{i<p&&d(e=>e+1)},disabled:i===p,className:"bg-teal-500 text-white py-2 px-4 rounded-full flex items-center justify-center ".concat(i===p?"opacity-50 cursor-not-allowed":"hover:bg-teal-600"),children:(0,r.jsx)(o.Dli,{})})]})]})}},61851:function(e,t,a){"use strict";var r=a(85893),n=a(83591),o=a.n(n);a(67294),t.Z=e=>{let{isOpen:t,onClose:a,children:n,width:s}=e;return t?(0,r.jsxs)("div",{className:"jsx-4a46d78616a448fb modal-overlay",children:[(0,r.jsxs)("div",{style:{maxWidth:s||"600px"},className:"jsx-4a46d78616a448fb modal-content",children:[" ",(0,r.jsx)("button",{onClick:a,className:"jsx-4a46d78616a448fb modal-close-button",children:"X"}),(0,r.jsx)("div",{className:"jsx-4a46d78616a448fb modal-body",children:n})]}),(0,r.jsx)(o(),{id:"4a46d78616a448fb",children:".modal-overlay.jsx-4a46d78616a448fb{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:rgba(0,0,0,.5);display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;z-index:1000;padding:20px}.modal-content.jsx-4a46d78616a448fb{background:white;padding:20px;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;position:relative;max-height:90vh;min-width:300px;width:100%;overflow:hidden}.modal-body.jsx-4a46d78616a448fb{max-height:-webkit-calc(90vh - 40px);max-height:-moz-calc(90vh - 40px);max-height:calc(90vh - 40px);overflow-y:auto}.modal-close-button.jsx-4a46d78616a448fb{position:absolute;top:10px;right:10px;background:transparent;border:none;font-size:16px;cursor:pointer}"})]}):null}},470:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var r=a(85893),n=a(67294),o=a(477),s=a(74),l=a(12510);async function i(e){try{if(!(await fetch("".concat("http://localhost:3000/api/v1","/saleDetails/").concat(e),{method:"DELETE"})).ok)throw Error("Error deleting sale detail");return!0}catch(e){throw console.error(e),e}}var d=a(55678),c=a(61851);let m="http://localhost:3000/api/v1";async function u(e){let t=await fetch("".concat(m,"/credits/").concat(e),{method:"DELETE"});if(!t.ok)throw Error("Error al eliminar el cr\xe9dito");return await t.json()}async function h(e,t){let a=await fetch("".concat(m,"/credits/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({amountRemaining:t})});if(!a.ok)throw Error("Error al actualizar el monto restante del cr\xe9dito");return await a.json()}let x="http://localhost:3000/api/v1";async function p(){let e=await fetch("".concat(x,"/CreditPayments"));if(!e.ok)throw Error("Error al obtener los detalles de cr\xe9dito");return await e.json()}async function y(e,t){let a=await fetch("".concat(x,"/CreditPayments/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw Error("Error al actualizar los detalles de cr\xe9dito");return await a.json()}async function b(e){let t=await fetch("".concat(x,"/CreditPayments/").concat(e),{method:"DELETE"});if(!t.ok)throw Error("Error al eliminar los detalles de cr\xe9dito");return await t.json()}a(79422);var g=()=>{var e,t,a;let[m,x]=(0,n.useState)([]),[g,f]=(0,n.useState)(!0),[w,j]=(0,n.useState)(!1),[v,N]=(0,n.useState)(!1),[E,D]=(0,n.useState)(null),[k,P]=(0,n.useState)({}),[C,S]=(0,n.useState)({id:0,date:new Date,totalAmount:0,paymentStatus:"PENDING",paymentMethod:"CASH",details:[],credit:{customerId:0,totalAmount:0,amountRemaining:0,status:"ACTIVE",payments:[]},creditPayments:[]});(0,n.useEffect)(()=>{(async()=>{try{let e=await (0,o.X8)();x(e)}catch(e){console.error("Error al obtener las ventas:",e)}finally{f(!1)}})()},[]);let T=async e=>{try{var t;console.log("Nueva",e);let a=null===(t=e.credit)||void 0===t?void 0:t.payments.every(e=>e.amountPaid===e.amountToPay),r={...e,paymentStatus:a?"PAID":"PENDING"},n=await (0,o.dQ)(r.id,r.paymentStatus);if(x(e=>e.map(e=>e.id===n.id?n:e)),"CREDIT"===e.paymentMethod&&e.credit){let t=await Promise.all(e.credit.payments.map(e=>y(e.id,{...e,paymentDate:new Date(e.paymentDate).toISOString()}))),a=e.credit.totalAmount-e.credit.payments.reduce((e,t)=>e+t.amountPaid,0);.01>Math.abs(a)&&(a=0),await h(e.credit.id,a),x(r=>r.map(r=>r.id===e.id?{...r,creditPayments:t,credit:{...r.credit,amountRemaining:a}}:r))}j(!1),d.Am.success("Venta actualizada exitosamente"),A()}catch(e){console.error("Error al actualizar la venta:",e),d.Am.error("Error al actualizar la venta")}},A=()=>{S({id:0,date:new Date,totalAmount:0,paymentStatus:"PENDING",paymentMethod:"CASH",details:[],credit:{customerId:0,totalAmount:0,amountRemaining:0,status:"ACTIVE",payments:[]},creditPayments:[]}),P({})},M=async e=>{try{if(console.log("Eliminando venta:",e),e.details)for(let t of e.details)console.log("Eliminando detalle de venta:",t),await i(t.id);if(console.log(e.creditPayments),console.log(e.credit),e.credit){let t=await p();for(let a of(console.log("Pagos del cr\xe9dito obtenidos:",t),t.filter(t=>{var a;return t.creditId===(null===(a=e.credit)||void 0===a?void 0:a.id)})))await b(a.id);e.credit.id&&await u(e.credit.id)}await (0,o.pe)(e.id),x(t=>t.filter(t=>t.id!==e.id)),d.Am.success("Venta eliminada exitosamente")}catch(e){d.Am.error("Hubo un problema al eliminar la venta"),console.error("Error al eliminar la venta:",e)}},I=e=>{switch(e){case"CASH":return"Efectivo";case"CREDIT":return"Cr\xe9dito";case"TRANSFER":return"Transferencia";default:return e}},F=e=>{switch(e){case"PAID":return"Pagado";case"PENDING":return"Pendiente";default:return e}},_=[{label:"ID",accessor:"id"},{label:"Total",accessor:"totalAmount"},{label:"M\xe9todo de Pago",accessor:"paymentMethod",render:e=>(0,r.jsx)("span",{children:I(e.paymentMethod)||null})},{label:"Estado",accessor:"paymentStatus",render:e=>(0,r.jsx)("span",{children:F(e.paymentStatus)||null})},{label:"Saldo Restante",accessor:"credit",render:e=>(0,r.jsx)("span",{children:e.credit?e.credit.amountRemaining:0})},{label:"Fechas de Cr\xe9dito",accessor:"credit",render:e=>{if(!e.credit)return(0,r.jsx)("span",{children:(0,l.WU)(new Date(e.date),"dd/MM/yyyy")});{var t,a;let n=(null===(a=e.credit)||void 0===a?void 0:null===(t=a.payments)||void 0===t?void 0:t.length)>0?(0,l.WU)(new Date(e.credit.payments[0].paymentDate),"dd/MM/yyyy"):"",o=e.credit.dueDate?(0,l.WU)(new Date(e.credit.dueDate),"dd/MM/yyyy"):"";return(0,r.jsx)("span",{children:n&&o?"".concat(n," - ").concat(o):n||o||null})}}}];return g?(0,r.jsx)("div",{children:"Cargando..."}):(0,r.jsxs)("div",{className:"p-8 bg-gradient-to-b from-teal-100 to-green-100 min-h-screen",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-6 text-teal-600",children:"Ventas"}),(0,r.jsx)(s.Z,{columns:_,data:m,onEdit:e=>{j(!0),N(!0),D(e),S(e)},onDelete:e=>M(e)}),(0,r.jsxs)(c.Z,{isOpen:w,onClose:()=>j(!1),width:"1300px",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-4",children:v?"Editar Venta":"Crear Nueva Venta"}),(0,r.jsxs)("div",{className:"flex gap-10",children:[(0,r.jsxs)("div",{className:"flex-grow w-1/2",children:["CREDIT"===C.paymentMethod&&C.credit?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-700 mb-2",htmlFor:"startDate",children:"Fecha de Inicio"}),(0,r.jsx)("input",{type:"date",id:"startDate",value:(null===(t=C.credit)||void 0===t?void 0:null===(e=t.payments)||void 0===e?void 0:e.length)?(0,l.WU)(new Date(C.credit.payments[0].paymentDate),"yyyy-MM-dd"):(0,l.WU)(new Date(C.date),"yyyy-MM-dd"),disabled:!0,onChange:e=>{let t=C.credit.payments.map((t,a)=>0===a?{...t,paymentDate:new Date(e.target.value).toISOString()}:t);S({...C,credit:{...C.credit,payments:t.map(e=>({...e,paymentDate:new Date(e.paymentDate)}))}})},className:"w-full p-4 border border-gray-300 rounded-lg text-black"})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-700 mb-2",htmlFor:"endDate",children:"Fecha de Fin"}),(0,r.jsx)("input",{type:"date",id:"endDate",value:(0,l.WU)(new Date(C.credit.dueDate||C.date),"yyyy-MM-dd"),disabled:!0,onChange:e=>S({...C,credit:{...C.credit,dueDate:new Date(e.target.value)}}),className:"w-full p-4 border border-gray-300 rounded-lg text-black"})]})]}):(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-700 mb-2",htmlFor:"date",children:"Fecha"}),(0,r.jsx)("input",{type:"date",id:"date",value:(0,l.WU)(new Date(C.date),"yyyy-MM-dd"),disabled:!0,onChange:e=>S({...C,date:new Date(e.target.value)}),className:"w-full p-4 border border-gray-300 rounded-lg text-black"})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-700 mb-2",htmlFor:"totalAmount",children:"Monto Total"}),(0,r.jsx)("input",{type:"number",id:"totalAmount",value:C.totalAmount,disabled:!0,onChange:e=>S({...C,totalAmount:parseFloat(e.target.value)}),className:"w-full p-4 border border-gray-300 rounded-lg text-black"})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-700 mb-2",htmlFor:"paymentStatus",children:"Estado del Pago"}),(0,r.jsxs)("select",{id:"paymentStatus",value:C.paymentStatus,onChange:e=>S({...C,paymentStatus:e.target.value}),className:"w-full p-4 border border-gray-300 rounded-lg text-black",children:[(0,r.jsx)("option",{value:"PAID",children:"Pagado"}),(0,r.jsx)("option",{value:"PENDING",children:"Pendiente"}),(0,r.jsx)("option",{value:"PARTIAL",children:"Parcial"})]})]})]}),C.credit&&C.credit.payments&&(0,r.jsxs)("div",{className:"flex-grow w-1/2 max-h-96 overflow-y-auto",children:[(0,r.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Pagos del Cr\xe9dito"}),(0,r.jsxs)("table",{className:"w-full border-collapse border border-gray-300",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"border border-gray-300 px-4 py-2",children:"Fecha de Pago"}),(0,r.jsx)("th",{className:"border border-gray-300 px-4 py-2",children:"Monto a Pagar"}),(0,r.jsx)("th",{className:"border border-gray-300 px-4 py-2",children:"Monto Pagado"}),(0,r.jsx)("th",{className:"border border-gray-300 px-4 py-2",children:"Seleccionar"})]})}),(0,r.jsx)("tbody",{children:null===(a=C.credit.payments)||void 0===a?void 0:a.sort((e,t)=>new Date(e.paymentDate).getTime()-new Date(t.paymentDate).getTime()).map((e,t)=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"border border-gray-300 px-4 py-2",children:(0,l.WU)(new Date(e.paymentDate),"dd/MM/yyyy")}),(0,r.jsx)("td",{className:"border border-gray-300 px-4 py-2",children:e.amountToPay}),(0,r.jsx)("td",{className:"border border-gray-300 px-4 py-2",children:void 0!==k[e.id||t]?(0,r.jsx)("input",{type:"number",value:k[e.id||t],onChange:a=>{let r=parseFloat(a.target.value);P(a=>({...a,[e.id||t]:r}))},onBlur:()=>{var a;let r=null===(a=C.credit.payments)||void 0===a?void 0:a.map(a=>a.id===e.id?{...a,amountPaid:k[e.id||t]}:a);S({...C,credit:{...C.credit,payments:r}}),P(a=>{let r={...a};return delete r[e.id||t],r})},className:"w-full p-2 border border-gray-300 rounded-lg text-black"}):(0,r.jsx)("span",{className:"cursor-pointer",onClick:()=>P(a=>({...a,[e.id||t]:e.amountPaid||0})),children:e.amountPaid})}),(0,r.jsx)("td",{className:"border border-gray-300 px-4 py-2",children:(0,r.jsx)("input",{type:"checkbox",checked:e.amountPaid===e.amountToPay,onChange:a=>{var r;let n=a.target.checked?e.amountToPay:0;P(a=>({...a,[e.id||t]:n}));let o=null===(r=C.credit.payments)||void 0===r?void 0:r.map(t=>t.id===e.id?{...t,amountPaid:n}:t);S({...C,credit:{...C.credit,payments:o}})}})})]},e.id||t))})]})]})]}),(0,r.jsx)("div",{className:"flex justify-end mt-4",children:(0,r.jsx)("button",{onClick:()=>{v&&T(C)},className:"bg-teal-500 text-white py-2 px-4 rounded-lg",children:"Guardar"})})]}),(0,r.jsx)(d.Ix,{})]})},f=()=>(0,r.jsx)(g,{})},477:function(e,t,a){"use strict";a.d(t,{X8:function(){return n},dQ:function(){return l},pe:function(){return s},qT:function(){return o}});let r=a(83454).env.NEXT_PUBLIC_API_URL||"http://localhost:3000/api/v1/sales";async function n(){try{let e=await fetch(r,{method:"GET"});if(!e.ok){let t=await e.json();throw Error(t.message||"Error fetching sales")}return await e.json()}catch(e){throw console.error("Error fetching sales:",e),e}}async function o(e){try{let t=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw Error(e.message||"Error creating sale")}return await t.json()}catch(e){throw console.error("Error creating sale:",e),e}}async function s(e){try{let t=await fetch("".concat(r,"/").concat(e),{method:"DELETE"});if(!t.ok){let e=await t.json();throw Error(e.message||"Error deleting sale")}return!0}catch(e){throw console.error("Error deleting sale:",e),e}}async function l(e,t){try{let a=await fetch("".concat(r,"/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentStatus:t})});if(!a.ok){let e=await a.json();throw Error(e.message||"Error updating sale status")}return await a.json()}catch(e){throw console.error("Error updating sale status:",e),e}}}},function(e){e.O(0,[125,888,774,179],function(){return e(e.s=25484)}),_N_E=e.O()}]);