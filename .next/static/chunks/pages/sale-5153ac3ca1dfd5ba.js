(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[761],{60959:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sale",function(){return r(11728)}])},11728:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return E}});var a=r(85893),n=r(67294),o=r(90746),i=r(58625),s=r(99416),c=r(477),l=r(73398),d=r(3314),u=r(91819),h=r(18159),f=r.n(h),y=r(37491),g=r(13567),p=r(84908),m=r(69493),j=r(99136),w=r(53668),x=()=>{let[e,t]=(0,n.useState)([]),[r,h]=(0,n.useState)(!0),[x,E]=(0,n.useState)([]);(0,n.useEffect)(()=>{let e=async()=>{try{let e=await (0,l.Xp)();E(e||[])}catch(e){console.error("Error al obtener los productos:",e)}};(async()=>{try{let e=await (0,c.X8)();t(e||[])}catch(e){console.error("Error al obtener las ventas:",e)}finally{h(!1)}})(),e()},[]);let b=(0,n.useMemo)(()=>e.reduce((e,t)=>e+t.totalAmount,0),[e]),P=(0,n.useMemo)(()=>e.flatMap(e=>e.details).reduce((e,t)=>(e[t.product.name]=(e[t.product.name]||0)+t.quantity,e),{}),[e]),T=(0,n.useMemo)(()=>{let t={};return e.forEach(e=>{let r=new Date(e.date).toLocaleDateString();t[r]=(t[r]||0)+e.totalAmount}),{labels:Object.keys(t),data:Object.values(t)}},[e]),v=(0,n.useMemo)(()=>x.reduce((e,t)=>e+t.purchasePrice,0),[x]),Z=(0,n.useMemo)(()=>e.reduce((e,t)=>(e[t.paymentMethod]=(e[t.paymentMethod]||0)+1,e),{}),[e]),[k,C]=(0,n.useState)({});(0,n.useEffect)(()=>{(async()=>{try{let e=(await (0,d.CP)()).reduce((e,t)=>(e[t.id]=t.name,e),{});C(e)}catch(e){console.error("Error al obtener las categor\xedas:",e)}})()},[]);let O=(0,n.useMemo)(()=>{let t={};return e.forEach(e=>{e.details.forEach(e=>{let r=k[e.product.categoryId]||"Desconocido";t[r]=(t[r]||0)+e.quantity})}),t},[e,k]),S=(0,n.useMemo)(()=>e.reduce((e,t)=>e+t.details.reduce((e,t)=>e+t.quantity,0),0),[e]),M=(0,n.useMemo)(()=>e.reduce((e,t)=>(e[t.paymentMethod]=(e[t.paymentMethod]||0)+t.totalAmount,e),{}),[e]);return r?(0,a.jsx)(y.ZP,{container:!0,justifyContent:"center",alignItems:"center",style:{height:"100vh"},children:(0,a.jsx)(g.Z,{})}):(0,a.jsx)("div",{children:(0,a.jsxs)(y.ZP,{container:!0,spacing:3,padding:3,children:[(0,a.jsx)(y.ZP,{item:!0,xs:12,children:(0,a.jsx)(p.Z,{variant:"h4",align:"center",gutterBottom:!0,children:"Panel de Ventas"})}),(0,a.jsx)(y.ZP,{item:!0,xs:12,md:6,lg:4,children:(0,a.jsx)(m.Z,{children:(0,a.jsxs)(j.Z,{children:[(0,a.jsx)(p.Z,{variant:"h6",children:"Productos M\xe1s Vendidos"}),(0,a.jsx)(o.v,{width:400,height:300,series:[{id:"products",data:Object.values(P)}],xAxis:[{id:"x",data:Object.keys(P),scaleType:"band",tickPlacement:"middle",tickLabelPlacement:"middle"}],yAxis:[{id:"quantity",label:"Cantidad",scaleType:"linear"}]})]})})}),(0,a.jsx)(y.ZP,{item:!0,xs:12,md:6,lg:4,children:(0,a.jsx)(m.Z,{children:(0,a.jsxs)(j.Z,{children:[(0,a.jsx)(i.u,{width:400,height:300,series:[{id:"sales-inventory",data:[{id:"Ventas",value:b,label:"Ventas"},{id:"Inventario",value:v,label:"Inventario"}],highlightScope:{fade:"global",highlight:"item"},faded:{innerRadius:30,additionalRadius:-30,color:"gray"},innerRadius:30,outerRadius:100,paddingAngle:5,cornerRadius:5,startAngle:-45,endAngle:225,cx:150,cy:150}]}),(0,a.jsx)(p.Z,{variant:"h6",align:"center",children:"Ventas vs Valor del Inventario"})]})})}),(0,a.jsx)(y.ZP,{item:!0,xs:12,md:6,lg:4,children:(0,a.jsx)(m.Z,{children:(0,a.jsxs)(j.Z,{children:[(0,a.jsx)(p.Z,{variant:"h6",children:"Ventas a lo largo del Tiempo"}),(0,a.jsx)(s.w,{width:350,height:300,series:[{id:"sales-over-time",data:T.data}],xAxis:[{id:"time",data:T.labels}]})]})})}),(0,a.jsx)(y.ZP,{item:!0,xs:12,md:6,lg:4,children:(0,a.jsx)(m.Z,{children:(0,a.jsxs)(j.Z,{children:[(0,a.jsx)(i.u,{width:500,height:260,series:[{id:"payment-methods",data:Object.entries(Z).map(e=>{let[t,r]=e;return{id:t,value:r,label:t}}),innerRadius:30,outerRadius:100,paddingAngle:5,cornerRadius:5,startAngle:-45,endAngle:225,cx:150,cy:150,highlightScope:{fade:"global",highlight:"item"},faded:{innerRadius:30,additionalRadius:-30,color:"gray"}}]}),(0,a.jsx)(p.Z,{variant:"h6",align:"center",children:"Tipos de Pago"})]})})}),(0,a.jsx)(y.ZP,{item:!0,xs:12,md:6,lg:4,children:(0,a.jsx)(m.Z,{children:(0,a.jsxs)(j.Z,{children:[(0,a.jsx)(p.Z,{variant:"h6",children:"Ventas por Categor\xeda"}),(0,a.jsx)(o.v,{width:400,height:260,series:[{id:"category-sales",data:Object.values(O)}],xAxis:[{id:"categories",data:Object.keys(O),scaleType:"band",tickPlacement:"middle",tickLabelPlacement:"middle"}],yAxis:[{id:"quantity",label:"Cantidad",scaleType:"linear"}]})]})})}),(0,a.jsx)(y.ZP,{item:!0,xs:12,md:6,lg:4,children:(0,a.jsx)(m.Z,{style:{height:"100%"},children:(0,a.jsx)(j.Z,{style:{backgroundColor:w.Z[300],display:"flex",flexDirection:"column",justifyContent:"center",height:"100%"},children:(0,a.jsx)(y.ZP,{container:!0,justifyContent:"center",children:(0,a.jsx)("button",{onClick:()=>{let e=new u.jsPDF;e.setFontSize(18),e.text("Informe de Ventas",14,20),e.setFontSize(12),e.text("Ingresos Totales: $".concat(b.toFixed(2)),14,30),e.text("Total Productos Vendidos: ".concat(S),14,40);let t=Object.entries(P).map(e=>{let[t,r]=e;return[t,r]});f()(e,{head:[["Producto","Unidades Vendidas"]],body:t,startY:50,theme:"grid",headStyles:{fillColor:[54,162,235]}});let r=Object.entries(M).map(e=>{let[t,r]=e;return[t,"$".concat(r.toFixed(2))]});f()(e,{head:[["M\xe9todo de Pago","Total Ventas"]],body:r,theme:"grid",headStyles:{fillColor:[255,99,132]}}),e.save("informe_ventas.pdf")},className:"bg-blue-500 text-white py-2 px-4 rounded-md mb-5",children:"Generar Informe de Ventas"})})})})})]})})},E=()=>(0,a.jsx)(x,{})},3314:function(e,t,r){"use strict";r.d(t,{CP:function(){return n},k4:function(){return o},uu:function(){return s},yr:function(){return i}});let a="http://localhost:3000/api/v1";async function n(){let e=await fetch("".concat(a,"/categories"));if(!e.ok)throw Error("Error al obtener las categor\xedas");return await e.json()}async function o(e){let t=await fetch("".concat(a,"/categories"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Error al crear la categor\xeda");return await t.json()}async function i(e,t){let r=await fetch("".concat(a,"/categories/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw Error("Error al actualizar la categor\xeda");return await r.json()}async function s(e){let t=await fetch("".concat(a,"/categories/").concat(e),{method:"DELETE"});if(!t.ok)throw Error("Error al eliminar la categor\xeda");return await t.json()}},73398:function(e,t,r){"use strict";r.d(t,{Ir:function(){return c},Xp:function(){return n},nM:function(){return i},qz:function(){return s},ry:function(){return o}});let a="http://localhost:3000/api/v1";async function n(){let e=await fetch("".concat(a,"/products"));if(!e.ok)throw Error("Error al obtener los productos");return await e.json()}async function o(e){let t=await fetch("".concat(a,"/products"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Error al crear el producto");return await t.json()}async function i(e,t){let r=await fetch("".concat(a,"/products/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw Error("Error al actualizar el producto");return await r.json()}async function s(e){let t=await fetch("".concat(a,"/products/").concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Error al actualizar el producto");return await t.json()}async function c(e){let t=await fetch("".concat(a,"/products/").concat(e),{method:"DELETE"});if(!t.ok)throw Error("Error al eliminar el producto");return await t.json()}},477:function(e,t,r){"use strict";r.d(t,{X8:function(){return n},dQ:function(){return s},pe:function(){return i},qT:function(){return o}});let a=r(83454).env.NEXT_PUBLIC_API_URL||"http://localhost:3000/api/v1/sales";async function n(){try{let e=await fetch(a,{method:"GET"});if(!e.ok){let t=await e.json();throw Error(t.message||"Error fetching sales")}return await e.json()}catch(e){throw console.error("Error fetching sales:",e),e}}async function o(e){try{let t=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw Error(e.message||"Error creating sale")}return await t.json()}catch(e){throw console.error("Error creating sale:",e),e}}async function i(e){try{let t=await fetch("".concat(a,"/").concat(e),{method:"DELETE"});if(!t.ok){let e=await t.json();throw Error(e.message||"Error deleting sale")}return!0}catch(e){throw console.error("Error deleting sale:",e),e}}async function s(e,t){try{let r=await fetch("".concat(a,"/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentStatus:t})});if(!r.ok){let e=await r.json();throw Error(e.message||"Error updating sale status")}return await r.json()}catch(e){throw console.error("Error updating sale status:",e),e}}}},function(e){e.O(0,[847,189,888,774,179],function(){return e(e.s=60959)}),_N_E=e.O()}]);