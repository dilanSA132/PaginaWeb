exports.id=2606,exports.ids=[2606],exports.modules={2606:(e,r,t)=>{"use strict";t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{default:()=>m});var s=t(997),o=t(6689),n=t(3590);t(8819);var i=t(5284),l=t(8538),c=t(7868),d=e([n]);n=(d.then?(await d)():d)[0];let m=({onSendSuccess:e})=>{let[r,t]=(0,o.useState)(""),[a,d]=(0,o.useState)(""),[m,u]=(0,o.useState)([]),[h,p]=(0,o.useState)(!1),[x,b]=(0,o.useState)(null),[f,g]=(0,o.useState)("marketing"),[j,y]=(0,o.useState)(""),[w,N]=(0,o.useState)([]),[v,E]=(0,o.useState)(""),[S,C]=(0,o.useState)(!1),[k,D]=(0,o.useState)([]),T={marketing:`
      <p>\xa1Hola, {{name}}!</p>
      <p>Queremos informarte sobre nuestras ofertas exclusivas para ti.</p>
      <p>No te pierdas nuestras promociones especiales. Vis\xedtanos hoy mismo.</p>
      <p>\xa1Gracias por ser parte de nuestra comunidad!</p>
    `,payment:`
      <p>Estimado {{name}},</p>
      <p>Este es un recordatorio de que tu pago est\xe1 pendiente. Por favor, realiza el pago lo antes posible.</p>
      <p>Detalles del pago:</p>
      <p>Asunto: Pago pendiente</p>
      <p>Gracias por tu atenci\xf3n.</p>
    `,info:`
      <p>Hola {{name}},</p>
      <p>Te estamos enviando este correo para mantenerte informado sobre las \xfaltimas actualizaciones.</p>
      <p>Visita nuestro sitio web para m\xe1s detalles.</p>
      <p>\xa1Gracias por seguir con nosotros!</p>
    `};(0,o.useEffect)(()=>{(async()=>{try{let e=await (0,l.Rf)();N(e)}catch(e){console.error("Error obteniendo usuarios:",e),b("No se pudieron cargar los usuarios.")}})()},[]),(0,o.useEffect)(()=>{y(T[f])},[f]),(0,o.useEffect)(()=>{(async()=>{try{let e=await (0,c.G5)();D(e)}catch(e){console.error("Error obteniendo correos:",e),b("No se pudieron cargar los correos.")}})()},[]);let O=(e,r)=>{r?u(r=>[...r,e]):u(r=>r.filter(r=>r.id!==e.id))},P=e=>{C(e),e?u(w):u([])},A=async e=>{let r=k[e];console.log("Este es el emailToDelete ",r);try{await (0,c.nd)(r.id),D(r=>r.filter((r,t)=>t!==e)),n.toast.success("Correo eliminado exitosamente")}catch(e){console.error("Error al eliminar el correo:",e),n.toast.error("Ocurri\xf3 un error al eliminar el correo")}},$=async t=>{if(t.preventDefault(),0===m.length){n.toast.error("Por favor, selecciona al menos un usuario.");return}p(!0),b(null);try{await Promise.all(m.map(async e=>{let t=j.replace("{{name}}",e.name),s={userName:e.name,email:e.email,subject:r,type:f,content:t,createdAt:a?new Date(a).toISOString():new Date().toISOString()},o=new Date().toISOString().split("T")[0],l=new Date(s.createdAt).toISOString().split("T")[0];console.log("comparaciom ",l,o),l===o?(await (0,i.C)(r,t,e.email),await (0,c.D$)(s),D(e=>[...e,s]),n.toast.success("Correos enviados exitosamente")):(await (0,c.D$)(s),D(e=>[...e,s]),n.toast.info("Se creo correctamente, se enviar\xe1 la fecha correspondiente."))})),e()}catch(e){e instanceof Error?(b(e.message),n.toast.error(e.message)):(n.toast.error("Ocurri\xf3 un error desconocido"),b("Ocurri\xf3 un error desconocido"))}finally{p(!1)}},L=w.filter(e=>e.name.toLowerCase().includes(v.toLowerCase())||e.email.toLowerCase().includes(v.toLowerCase()));return s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-8",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto p-10 bg-white shadow-lg rounded-lg",children:[s.jsx("h1",{className:"text-4xl font-semibold text-center text-gray-800 mb-8",children:"Enviar Correos Personalizados"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-12",children:[s.jsx("div",{className:"p-8 bg-gray-100 rounded-lg shadow-md",children:s.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Vista Previa y Edici\xf3n"})}),s.jsx("div",{className:"space-y-8",children:(0,s.jsxs)("form",{onSubmit:$,className:"space-y-6",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"subject",className:"block text-sm font-medium text-gray-700",children:"Asunto:"}),s.jsx("input",{type:"text",id:"subject",className:"mt-1 p-3 w-full text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:r,onChange:e=>t(e.target.value),required:!0})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"scheduleDate",className:"block text-sm font-medium text-gray-700",children:"Enviar Programado:"}),s.jsx("input",{type:"datetime-local",id:"scheduleDate",className:"mt-1 p-3 w-full text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:a,onChange:e=>d(e.target.value)})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"currentDate",className:"block text-sm font-medium text-gray-700",children:"Fecha Actual:"}),s.jsx("button",{type:"button",id:"currentDate",className:"mt-1 p-2 bg-gray-300 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:()=>d(new Date().toISOString().slice(0,16)),children:"Actual"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"template",className:"block text-sm font-medium text-gray-700",children:"Seleccionar Plantilla:"}),(0,s.jsxs)("select",{id:"template",className:"mt-1 p-3 w-full text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:f,onChange:e=>g(e.target.value),children:[s.jsx("option",{value:"marketing",children:"Marketing"}),s.jsx("option",{value:"payment",children:"Aviso de Pago"}),s.jsx("option",{value:"info",children:"Informaci\xf3n"})]})]}),s.jsx("div",{children:s.jsx("input",{type:"text",placeholder:"Filtrar usuarios por nombre o correo",className:"mt-1 p-3 w-full text-sm border border-gray-300 rounded-md shadow-sm",value:v,onChange:e=>E(e.target.value)})}),(0,s.jsxs)("div",{children:[s.jsx("h3",{className:"text-lg font-semibold",children:"Selecciona Usuarios:"}),s.jsx("div",{className:"overflow-y-auto max-h-80",children:(0,s.jsxs)("table",{className:"w-full mt-2 border text-sm",children:[s.jsx("thead",{children:(0,s.jsxs)("tr",{children:[s.jsx("th",{className:"p-3 border",children:s.jsx("input",{type:"checkbox",checked:S,onChange:e=>P(e.target.checked)})}),s.jsx("th",{className:"p-3 border",children:"Nombre"}),s.jsx("th",{className:"p-3 border",children:"Email"})]})}),s.jsx("tbody",{children:L.map(e=>(0,s.jsxs)("tr",{children:[s.jsx("td",{className:"p-3 border text-center",children:s.jsx("input",{type:"checkbox",checked:m.some(r=>r.id===e.id),onChange:r=>O(e,r.target.checked)})}),s.jsx("td",{className:"p-3 border",children:e.name}),s.jsx("td",{className:"p-3 border",children:e.email})]},e.id))})]})})]}),x&&s.jsx("p",{className:"text-red-500 text-xs",children:x}),s.jsx("div",{className:"flex justify-center",children:s.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-6 py-3 rounded-lg text-sm font-semibold hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-500 disabled:bg-gray-300",disabled:h,children:h?"Enviando...":"Enviar Correos"})})]})}),(0,s.jsxs)("div",{className:"col-span-1 lg:col-span-1 mt-8 lg:mt-0 max-h-96 overflow-y-auto",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Correos Enviados:"}),(0,s.jsxs)("table",{className:"w-full mt-2 border text-sm",children:[s.jsx("thead",{children:(0,s.jsxs)("tr",{children:[s.jsx("th",{className:"p-3 border",children:"Asunto"}),s.jsx("th",{className:"p-3 border",children:"Destinatario"}),s.jsx("th",{className:"p-3 border",children:"Fecha de Env\xedo"}),s.jsx("th",{className:"p-3 border",children:"Tipo"}),s.jsx("th",{className:"p-3 border",children:"Acciones"})]})}),s.jsx("tbody",{children:k.map((e,r)=>(0,s.jsxs)("tr",{children:[s.jsx("td",{className:"p-3 border",children:e.subject}),s.jsx("td",{className:"p-3 border",children:e.email}),s.jsx("td",{className:"p-3 border",children:new Date(e.createdAt).toLocaleString()}),s.jsx("td",{className:"p-3 border",children:e.type}),s.jsx("td",{className:"p-3 border text-center",children:s.jsx("button",{className:"bg-red-500 text-white px-3 py-2 rounded hover:bg-red-600",onClick:()=>A(r),children:"Eliminar"})})]},r))})]})]})]}),s.jsx(n.ToastContainer,{})]})})};a()}catch(e){a(e)}})},5284:(e,r,t)=>{"use strict";t.d(r,{C:()=>a});let a=async(e,r,t)=>{let a=await fetch("http://localhost:3000/api/v1/emails",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subject:e,html:r,recipientEmail:t})});if(!a.ok)throw Error((await a.json()).message||"Error enviando correo");return a.json()}},7868:(e,r,t)=>{"use strict";t.d(r,{D$:()=>o,G5:()=>s,nd:()=>n});let a="http://localhost:3000/api/v1";async function s(){let e=await fetch(`${a}/email`);if(!e.ok)throw Error("Error al obtener los correos");return await e.json()}async function o(e){let r=await fetch(`${a}/email`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)throw Error("Error al crear el correo");return await r.json()}async function n(e){let r=await fetch(`${a}/email/${e}`,{method:"DELETE"});if(!r.ok)throw Error("Error al eliminar el correo");return await r.json()}},8538:(e,r,t)=>{"use strict";t.d(r,{Nq:()=>i,Rf:()=>s,h8:()=>n,r4:()=>o});let a="http://localhost:3000/api/v1";if(!a)throw Error("NEXT_PUBLIC_API_URL is not defined in the environment variables");let s=async()=>{let e=await fetch(a);if(!e.ok)throw Error("Error al obtener los usuarios");return await e.json()},o=async e=>{let r=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)throw Error("Error al crear el usuario");return await r.json()},n=async e=>{let r=await fetch(`${a}/${e}`,{method:"DELETE"});if(!r.ok)throw Error("Error al eliminar el usuario");return await r.json()},i=async(e,r)=>{let t=await fetch(`${a}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!t.ok)throw Error("Error al actualizar el usuario");return await t.json()}},8819:()=>{}};